#!/usr/bin/perl

use strict;
use warnings;

use FindBin;
BEGIN { unshift @INC, "$FindBin::Bin/../lib" }

chdir "$FindBin::Bin/..";

sub create_db {
  system ('rm -rf share/data/database.db');
  system ('sqlite3 share/data/database.db < share/data/database.sql');
}

sub update_roster {
  require DreamGuild::Utils::Roster;
  DreamGuild::Utils::Roster->new->update_roster;
}

sub start_server {
  system ('hypnotoad script/dreamguild-www');
}

sub stop_server {
  system ('hypnotoad -s script/dreamguild-www');
}

sub start_morbo {
  system ('morbo script/dreamguild-www');
}


sub main {
  return if not defined $ARGV[0];
  return create_db ()       if $ARGV[0] eq '--create-db';
  return update_roster ()   if $ARGV[0] eq '--update-roster';
  return start_server ()    if $ARGV[0] eq '--start-server';
  return stop_server ()     if $ARGV[0] eq '--stop-server';
  return start_morbo ()     if $ARGV[0] eq '--morbo';
}


&main;
0;
